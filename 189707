local isGUIVisible = true
local mainFramePosition = UDim2.new(0.435, 0, 0.273, 0)
local toggleIconPosition = UDim2.new(0, 20, 1, -85)

local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")

local function setupDrag(frame)
    local dragToggle = false
    local dragInput, dragStart, startPos

    local function updateInput(input)
        local Delta = input.Position - dragStart
        local Position = UDim2.new(
            startPos.X.Scale, 
            startPos.X.Offset + Delta.X, 
            startPos.Y.Scale, 
            startPos.Y.Offset + Delta.Y
        )
        
        TweenService:Create(frame, TweenInfo.new(0.15), {Position = Position}):Play()
    end

    frame.InputBegan:Connect(function(input)
        if (input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch) 
            and UserInputService:GetFocusedTextBox() == nil then
            
            dragToggle = true
            dragStart = input.Position
            startPos = frame.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragToggle = false
                end
            end)
        end
    end)

    frame.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            dragInput = input
        end
    end)

    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragToggle then
            updateInput(input)
        end
    end)
end

local function createNotification(text, bgColor, iconId)
    local NotificationGui = Instance.new("ScreenGui")
    NotificationGui.Name = "Notification"
    NotificationGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    NotificationGui.DisplayOrder = 1000
    NotificationGui.Parent = game:GetService("CoreGui")

    local MainFrame = Instance.new("Frame")
    MainFrame.Size = UDim2.new(0, 300, 0, 80)
    MainFrame.Position = UDim2.new(1, -320, 1, -100)
    MainFrame.BackgroundColor3 = bgColor
    MainFrame.BackgroundTransparency = 0.1
    MainFrame.BorderSizePixel = 0
    MainFrame.Parent = NotificationGui

    local FrameCorner = Instance.new("UICorner")
    FrameCorner.CornerRadius = UDim.new(0, 12)
    FrameCorner.Parent = MainFrame

    local FrameStroke = Instance.new("UIStroke")
    FrameStroke.Thickness = 2
    FrameStroke.Color = Color3.fromRGB(100, 100, 150)
    FrameStroke.Parent = MainFrame

    local IconImage = Instance.new("ImageLabel")
    IconImage.Size = UDim2.new(0, 50, 0, 50)
    IconImage.Position = UDim2.new(0, 15, 0.5, -25)
    IconImage.BackgroundTransparency = 1
    IconImage.Image = "rbxassetid://" .. tostring(iconId)
    IconImage.ScaleType = Enum.ScaleType.Fit
    IconImage.Parent = MainFrame

    local NotificationText = Instance.new("TextLabel")
    NotificationText.Size = UDim2.new(1, -90, 1, -20)
    NotificationText.Position = UDim2.new(0, 80, 0, 10)
    NotificationText.BackgroundTransparency = 1
    NotificationText.Text = text
    NotificationText.TextColor3 = Color3.fromRGB(255, 255, 255)
    NotificationText.TextSize = 16
    NotificationText.Font = Enum.Font.GothamBold
    NotificationText.TextXAlignment = Enum.TextXAlignment.Left
    NotificationText.TextWrapped = true
    NotificationText.Parent = MainFrame

    MainFrame.Position = UDim2.new(1, 350, 1, -100)
    MainFrame:TweenPosition(UDim2.new(1, -320, 1, -100), Enum.EasingDirection.Out, Enum.EasingStyle.Quad, 0.5, true)

    task.delay(2.5, function()
        if MainFrame and MainFrame.Parent then
            MainFrame:TweenPosition(UDim2.new(1, 350, 1, -100), Enum.EasingDirection.In, Enum.EasingStyle.Quad, 0.5, true)
            task.wait(0.5)
            NotificationGui:Destroy()
        end
    end)
end

local function createNullFireNotification(text, isFinal)
    local NotificationGui = Instance.new("ScreenGui")
    NotificationGui.Name = "NullFireNotification"
    NotificationGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    NotificationGui.DisplayOrder = 1000
    NotificationGui.Parent = game:GetService("CoreGui")

    local MainFrame = Instance.new("Frame")
    MainFrame.Size = UDim2.new(0, 300, 0, 80)
    MainFrame.Position = UDim2.new(1, -320, 1, -100)
    MainFrame.BackgroundColor3 = Color3.fromRGB(40, 30, 80)
    MainFrame.BackgroundTransparency = 0.1
    MainFrame.BorderSizePixel = 0
    MainFrame.Parent = NotificationGui

    local FrameCorner = Instance.new("UICorner")
    FrameCorner.CornerRadius = UDim.new(0, 12)
    FrameCorner.Parent = MainFrame

    local FrameStroke = Instance.new("UIStroke")
    FrameStroke.Thickness = 2
    FrameStroke.Color = Color3.fromRGB(80, 60, 120)
    FrameStroke.Parent = MainFrame

    local NotificationText = Instance.new("TextLabel")
    NotificationText.Size = UDim2.new(1, -40, 1, -20)
    NotificationText.Position = UDim2.new(0, 20, 0, 10)
    NotificationText.BackgroundTransparency = 1
    NotificationText.Text = text
    NotificationText.TextColor3 = Color3.fromRGB(220, 200, 255)
    NotificationText.TextSize = 16
    NotificationText.Font = Enum.Font.GothamBold
    NotificationText.TextXAlignment = Enum.TextXAlignment.Left
    NotificationText.TextWrapped = true
    NotificationText.Parent = MainFrame

    MainFrame.Position = UDim2.new(1, 350, 1, -100)
    MainFrame:TweenPosition(UDim2.new(1, -320, 1, -100), Enum.EasingDirection.Out, Enum.EasingStyle.Quad, 0.5, true)

    if isFinal then
        task.delay(2.5, function()
            if MainFrame and MainFrame.Parent then
                MainFrame:TweenPosition(UDim2.new(1, 350, 1, -100), Enum.EasingDirection.In, Enum.EasingStyle.Quad, 0.5, true)
                task.wait(0.5)
                NotificationGui:Destroy()
            end
        end)
    end

    return NotificationGui
end

local function createInfiniteYieldNotification(text, isFinal)
    local NotificationGui = Instance.new("ScreenGui")
    NotificationGui.Name = "InfiniteYieldNotification"
    NotificationGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    NotificationGui.DisplayOrder = 1000
    NotificationGui.Parent = game:GetService("CoreGui")

    local MainFrame = Instance.new("Frame")
    MainFrame.Size = UDim2.new(0, 300, 0, 80)
    MainFrame.Position = UDim2.new(1, -320, 1, -100)
    MainFrame.BackgroundColor3 = Color3.fromRGB(80, 30, 30)
    MainFrame.BackgroundTransparency = 0.1
    MainFrame.BorderSizePixel = 0
    MainFrame.Parent = NotificationGui

    local FrameCorner = Instance.new("UICorner")
    FrameCorner.CornerRadius = UDim.new(0, 12)
    FrameCorner.Parent = MainFrame

    local FrameStroke = Instance.new("UIStroke")
    FrameStroke.Thickness = 2
    FrameStroke.Color = Color3.fromRGB(150, 50, 50)
    FrameStroke.Parent = MainFrame

    local IconImage = Instance.new("ImageLabel")
    IconImage.Size = UDim2.new(0, 50, 0, 50)
    IconImage.Position = UDim2.new(0, 15, 0.5, -25)
    IconImage.BackgroundTransparency = 1
    IconImage.Image = "rbxassetid://74025253095991"
    IconImage.ScaleType = Enum.ScaleType.Fit
    IconImage.Parent = MainFrame

    local NotificationText = Instance.new("TextLabel")
    NotificationText.Size = UDim2.new(1, -90, 1, -20)
    NotificationText.Position = UDim2.new(0, 80, 0, 10)
    NotificationText.BackgroundTransparency = 1
    NotificationText.Text = text
    NotificationText.TextColor3 = Color3.fromRGB(255, 200, 200)
    NotificationText.TextSize = 16
    NotificationText.Font = Enum.Font.GothamBold
    NotificationText.TextXAlignment = Enum.TextXAlignment.Left
    NotificationText.TextWrapped = true
    NotificationText.Parent = MainFrame

    MainFrame.Position = UDim2.new(1, 350, 1, -100)
    MainFrame:TweenPosition(UDim2.new(1, -320, 1, -100), Enum.EasingDirection.Out, Enum.EasingStyle.Quad, 0.5, true)

    if isFinal then
        task.delay(2.5, function()
            if MainFrame and MainFrame.Parent then
                MainFrame:TweenPosition(UDim2.new(1, 350, 1, -100), Enum.EasingDirection.In, Enum.EasingStyle.Quad, 0.5, true)
                task.wait(0.5)
                NotificationGui:Destroy()
            end
        end)
    end

    return NotificationGui
end

local function createEgorNotification(text, isFinal)
    local NotificationGui = Instance.new("ScreenGui")
    NotificationGui.Name = "EgorNotification"
    NotificationGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    NotificationGui.DisplayOrder = 1000
    NotificationGui.Parent = game:GetService("CoreGui")

    local MainFrame = Instance.new("Frame")
    MainFrame.Size = UDim2.new(0, 300, 0, 80)
    MainFrame.Position = UDim2.new(1, -320, 1, -100)
    MainFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
    MainFrame.BackgroundTransparency = 0.1
    MainFrame.BorderSizePixel = 0
    MainFrame.Parent = NotificationGui

    local FrameCorner = Instance.new("UICorner")
    FrameCorner.CornerRadius = UDim.new(0, 12)
    FrameCorner.Parent = MainFrame

    local FrameStroke = Instance.new("UIStroke")
    FrameStroke.Thickness = 2
    FrameStroke.Color = Color3.fromRGB(80, 80, 80)
    FrameStroke.Parent = MainFrame

    local NotificationText = Instance.new("TextLabel")
    NotificationText.Size = UDim2.new(1, -40, 1, -20)
    NotificationText.Position = UDim2.new(0, 20, 0, 10)
    NotificationText.BackgroundTransparency = 1
    NotificationText.Text = text
    NotificationText.TextColor3 = Color3.fromRGB(220, 220, 220)
    NotificationText.TextSize = 16
    NotificationText.Font = Enum.Font.GothamBold
    NotificationText.TextXAlignment = Enum.TextXAlignment.Left
    NotificationText.TextWrapped = true
    NotificationText.Parent = MainFrame

    MainFrame.Position = UDim2.new(1, 350, 1, -100)
    MainFrame:TweenPosition(UDim2.new(1, -320, 1, -100), Enum.EasingDirection.Out, Enum.EasingStyle.Quad, 0.5, true)

    if isFinal then
        task.delay(2.5, function()
            if MainFrame and MainFrame.Parent then
                MainFrame:TweenPosition(UDim2.new(1, 350, 1, -100), Enum.EasingDirection.In, Enum.EasingStyle.Quad, 0.5, true)
                task.wait(0.5)
                NotificationGui:Destroy()
            end
        end)
    end

    return NotificationGui
end

local function createFullGUI()
    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "TrowHackGUI"
    ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    ScreenGui.DisplayOrder = 999
    ScreenGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")

    local MainFrame = Instance.new("Frame")
    MainFrame.Name = "MainFrame"
    MainFrame.Size = UDim2.new(0, 251, 0, 332)
    MainFrame.Position = mainFramePosition
    MainFrame.BackgroundColor3 = Color3.fromRGB(60, 255, 0)
    MainFrame.BorderSizePixel = 0
    MainFrame.Visible = isGUIVisible
    MainFrame.Parent = ScreenGui

    local FrameCorner = Instance.new("UICorner")
    FrameCorner.CornerRadius = UDim.new(0, 12)
    FrameCorner.Parent = MainFrame

    local FrameStroke = Instance.new("UIStroke")
    FrameStroke.Thickness = 2
    FrameStroke.Color = Color3.fromRGB(0, 80, 0)
    FrameStroke.Parent = MainFrame

    local LogoButton = Instance.new("ImageButton")
    LogoButton.Name = "Logo"
    LogoButton.Size = UDim2.new(0, 225, 0, 150)
    LogoButton.Position = UDim2.new(0.052, 0, -0.453, 0)
    LogoButton.Image = "rbxassetid://118649291600769"
    LogoButton.ImageTransparency = 0.03
    LogoButton.BackgroundTransparency = 1
    LogoButton.BorderSizePixel = 0
    LogoButton.Parent = MainFrame

    local Title = Instance.new("TextLabel")
    Title.Size = UDim2.new(1, 0, 0, 40)
    Title.Position = UDim2.new(0, 0, 0, 0)
    Title.BackgroundColor3 = Color3.fromRGB(15, 30, 15)
    Title.BackgroundTransparency = 0.3
    Title.Text = "TROWHACK"
    Title.TextColor3 = Color3.fromRGB(150, 255, 150)
    Title.TextSize = 18
    Title.Font = Enum.Font.GothamBold
    Title.Parent = MainFrame

    local CloseButton = Instance.new("TextButton")
    CloseButton.Size = UDim2.new(0, 25, 0, 25)
    CloseButton.Position = UDim2.new(1, -30, 0, 8)
    CloseButton.BackgroundColor3 = Color3.fromRGB(80, 30, 30)
    CloseButton.Text = "X"
    CloseButton.TextColor3 = Color3.fromRGB(255, 200, 200)
    CloseButton.TextSize = 12
    CloseButton.Font = Enum.Font.GothamBold
    CloseButton.Parent = Title

    local CloseCorner = Instance.new("UICorner")
    CloseCorner.CornerRadius = UDim.new(0, 6)
    CloseCorner.Parent = CloseButton

    local ToggleIcon = Instance.new("ImageButton")
    ToggleIcon.Name = "ToggleIcon"
    ToggleIcon.Size = UDim2.new(0, 75, 0, 75)
    ToggleIcon.Position = toggleIconPosition
    ToggleIcon.AnchorPoint = Vector2.new(0, 1)
    ToggleIcon.BackgroundTransparency = 1
    ToggleIcon.Image = "rbxassetid://99997475083040"
    ToggleIcon.BorderSizePixel = 0
    ToggleIcon.Visible = not isGUIVisible
    ToggleIcon.Parent = ScreenGui

    local ButtonsFrame = Instance.new("Frame")
    ButtonsFrame.Size = UDim2.new(1, -30, 0, 280)
    ButtonsFrame.Position = UDim2.new(0, 15, 0, 50)
    ButtonsFrame.BackgroundTransparency = 1
    ButtonsFrame.Parent = MainFrame

    local InfiniteYieldButton = Instance.new("TextButton")
    InfiniteYieldButton.Size = UDim2.new(1, 0, 0, 60)
    InfiniteYieldButton.Position = UDim2.new(0, 0, 0, 0)
    InfiniteYieldButton.BackgroundColor3 = Color3.fromRGB(80, 30, 30)
    InfiniteYieldButton.Text = "Infiniteꨄ︎Yield"
    InfiniteYieldButton.TextColor3 = Color3.fromRGB(255, 200, 200)
    InfiniteYieldButton.TextSize = 16
    InfiniteYieldButton.Font = Enum.Font.GothamBold
    InfiniteYieldButton.Parent = ButtonsFrame

    local InfiniteYieldCorner = Instance.new("UICorner")
    InfiniteYieldCorner.CornerRadius = UDim.new(0, 8)
    InfiniteYieldCorner.Parent = InfiniteYieldButton

    local InfiniteYieldStroke = Instance.new("UIStroke")
    InfiniteYieldStroke.Thickness = 2
    InfiniteYieldStroke.Color = Color3.fromRGB(150, 50, 50)
    InfiniteYieldStroke.Parent = InfiniteYieldButton

    local NullFireButton = Instance.new("TextButton")
    NullFireButton.Size = UDim2.new(1, 0, 0, 60)
    NullFireButton.Position = UDim2.new(0, 0, 0, 70)
    NullFireButton.BackgroundColor3 = Color3.fromRGB(40, 30, 80)
    NullFireButton.Text = "Null-Fire"
    NullFireButton.TextColor3 = Color3.fromRGB(220, 200, 255)
    NullFireButton.TextSize = 16
    NullFireButton.Font = Enum.Font.GothamBold
    NullFireButton.Parent = ButtonsFrame

    local NullFireCorner = Instance.new("UICorner")
    NullFireCorner.CornerRadius = UDim.new(0, 8)
    NullFireCorner.Parent = NullFireButton

    local NullFireStroke = Instance.new("UIStroke")
    NullFireStroke.Thickness = 2
    NullFireStroke.Color = Color3.fromRGB(80, 60, 120)
    NullFireStroke.Parent = NullFireButton

    local EgorButton = Instance.new("TextButton")
    EgorButton.Size = UDim2.new(1, 0, 0, 60)
    EgorButton.Position = UDim2.new(0, 0, 0, 140)
    EgorButton.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
    EgorButton.Text = "Roblox Egor"
    EgorButton.TextColor3 = Color3.fromRGB(220, 220, 220)
    EgorButton.TextSize = 16
    EgorButton.Font = Enum.Font.GothamBold
    EgorButton.Parent = ButtonsFrame

    local EgorCorner = Instance.new("UICorner")
    EgorCorner.CornerRadius = UDim.new(0, 8)
    EgorCorner.Parent = EgorButton

    local EgorStroke = Instance.new("UIStroke")
    EgorStroke.Thickness = 2
    EgorStroke.Color = Color3.fromRGB(80, 80, 80)
    EgorStroke.Parent = EgorButton

    local TelegramButton = Instance.new("ImageButton")
    TelegramButton.Size = UDim2.new(1, 0, 0, 60)
    TelegramButton.Position = UDim2.new(0, 0, 0, 210)
    TelegramButton.BackgroundColor3 = Color3.fromRGB(30, 60, 90)
    TelegramButton.BackgroundTransparency = 1
    TelegramButton.Image = "rbxassetid://125399669098418"
    TelegramButton.ScaleType = Enum.ScaleType.Fit
    TelegramButton.Parent = ButtonsFrame

    local TelegramCorner = Instance.new("UICorner")
    TelegramCorner.CornerRadius = UDim.new(0, 8)
    TelegramCorner.Parent = TelegramButton

    local function loadInfiniteYield()
        local notification = createInfiniteYieldNotification("Loading Infinite Yield...", false)
        InfiniteYieldButton.Text = "Loading..."
        InfiniteYieldButton.BackgroundColor3 = Color3.fromRGB(100, 40, 40)
        
        local success = pcall(function()
            loadstring(game:HttpGet('https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source'))()
        end)
        
        notification:Destroy()
        
        if success then
            createInfiniteYieldNotification("Infinite Yield Loaded!", true)
            InfiniteYieldButton.Text = "Loaded!"
            InfiniteYieldButton.BackgroundColor3 = Color3.fromRGB(80, 30, 30)
            task.wait(2)
        else
            createInfiniteYieldNotification("Error Loading Infinite Yield!", true)
            InfiniteYieldButton.Text = "Error!"
            InfiniteYieldButton.BackgroundColor3 = Color3.fromRGB(120, 40, 40)
            task.wait(2)
        end
        
        InfiniteYieldButton.Text = "Infiniteꨄ︎Yield"
        InfiniteYieldButton.BackgroundColor3 = Color3.fromRGB(80, 30, 30)
    end

    local function loadNullFire()
        local notification = createNullFireNotification("Loading Null-Fire...", false)
        NullFireButton.Text = "Loading..."
        NullFireButton.BackgroundColor3 = Color3.fromRGB(60, 50, 120)
        
        local success = pcall(function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/InfernusScripts/Null-Fire/main/Loader"))()
        end)
        
        notification:Destroy()
        
        if success then
            createNullFireNotification("Null-Fire Loaded!", true)
            NullFireButton.Text = "Loaded!"
            NullFireButton.BackgroundColor3 = Color3.fromRGB(80, 70, 160)
            task.wait(2)
        else
            createNullFireNotification("Error Loading Null-Fire!", true)
            NullFireButton.Text = "Error!"
            NullFireButton.BackgroundColor3 = Color3.fromRGB(120, 40, 40)
            task.wait(2)
        end
        
        NullFireButton.Text = "Null-Fire"
        NullFireButton.BackgroundColor3 = Color3.fromRGB(40, 30, 80)
    end

    local function loadEgor()
        local notification = createEgorNotification("Loading Roblox Egor...", false)
        EgorButton.Text = "Loading..."
        EgorButton.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
        
        local success = pcall(function()
            loadstring(game:HttpGet("https://pastebin.com/raw/GBmWn4eZ", true))()
        end)
        
        notification:Destroy()
        
        if success then
            createEgorNotification("Roblox Egor Loaded!", true)
            EgorButton.Text = "Loaded!"
            EgorButton.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
            task.wait(2)
        else
            createEgorNotification("Error Loading Roblox Egor!", true)
            EgorButton.Text = "Error!"
            EgorButton.BackgroundColor3 = Color3.fromRGB(80, 30, 30)
            task.wait(2)
        end
        
        EgorButton.Text = "Roblox Egor"
        EgorButton.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
    end

    local function copyToClipboard(text)
        local SetClipboard = setclipboard or toclipboard or set_clipboard
        if SetClipboard then
            SetClipboard(text)
            return true
        end
        return false
    end

    local function onTelegramClick()
        local telegramLink = "t.me/TrowHack"
        local success = copyToClipboard(telegramLink)
        
        if success then
            createNotification("TG COPIED!", Color3.fromRGB(30, 60, 90), 125399669098418)
        else
            createNotification("COPY FAILED!", Color3.fromRGB(80, 30, 30), 125399669098418)
        end
    end

    InfiniteYieldButton.MouseButton1Click:Connect(loadInfiniteYield)
    NullFireButton.MouseButton1Click:Connect(loadNullFire)
    EgorButton.MouseButton1Click:Connect(loadEgor)
    TelegramButton.MouseButton1Click:Connect(onTelegramClick)

    TelegramButton.MouseEnter:Connect(function()
        TelegramButton.ImageColor3 = Color3.fromRGB(150, 150, 150)
    end)

    TelegramButton.MouseLeave:Connect(function()
        TelegramButton.ImageColor3 = Color3.fromRGB(255, 255, 255)
    end)

    local function closeGUI()
        local closeTween = TweenService:Create(MainFrame, TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
            Position = UDim2.new(1.5, 0, mainFramePosition.Y.Scale, mainFramePosition.Y.Offset)
        })
        closeTween:Play()
        closeTween.Completed:Wait()
        isGUIVisible = false
        MainFrame.Visible = false
        
        -- Анимация появления ToggleIcon
        ToggleIcon.Visible = true
        ToggleIcon.Position = UDim2.new(toggleIconPosition.X.Scale, toggleIconPosition.X.Offset, 1.5, toggleIconPosition.Y.Offset)
        TweenService:Create(ToggleIcon, TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
            Position = toggleIconPosition
        }):Play()
    end

    local function showGUI()
        -- Анимация исчезновения ToggleIcon
        ToggleIcon.Visible = true
        local hideIconTween = TweenService:Create(ToggleIcon, TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
            Position = UDim2.new(toggleIconPosition.X.Scale, toggleIconPosition.X.Offset, 1.5, toggleIconPosition.Y.Offset)
        })
        hideIconTween:Play()
        hideIconTween.Completed:Connect(function()
            ToggleIcon.Visible = false
        end)
        
        MainFrame.Position = UDim2.new(-0.5, 0, mainFramePosition.Y.Scale, mainFramePosition.Y.Offset)
        MainFrame.Visible = true
        local openTween = TweenService:Create(MainFrame, TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
            Position = mainFramePosition
        })
        openTween:Play()
        isGUIVisible = true
    end

    local function toggleGUI()
        if isGUIVisible then
            closeGUI()
        else
            showGUI()
        end
    end

    CloseButton.MouseButton1Click:Connect(closeGUI)

    setupDrag(MainFrame)

    -- Применяем такое же поведение перетаскивания для ToggleIcon
    local iconDragToggle = false
    local iconDragInput, iconDragStart, iconStartPos

    local function updateIconInput(input)
        local Delta = input.Position - iconDragStart
        local Position = UDim2.new(
            iconStartPos.X.Scale, 
            iconStartPos.X.Offset + Delta.X, 
            iconStartPos.Y.Scale, 
            iconStartPos.Y.Offset + Delta.Y
        )
        
        TweenService:Create(ToggleIcon, TweenInfo.new(0.15), {Position = Position}):Play()
        toggleIconPosition = Position
    end

    ToggleIcon.InputBegan:Connect(function(input)
        if (input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch) 
            and UserInputService:GetFocusedTextBox() == nil then
            
            iconDragToggle = true
            iconDragStart = input.Position
            iconStartPos = ToggleIcon.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    iconDragToggle = false
                end
            end)
        end
    end)

    ToggleIcon.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            iconDragInput = input
        end
    end)

    UserInputService.InputChanged:Connect(function(input)
        if input == iconDragInput and iconDragToggle then
            updateIconInput(input)
        end
    end)

    ToggleIcon.MouseButton1Click:Connect(function()
        if not iconDragToggle then
            showGUI()
        end
    end)

    UserInputService.InputBegan:Connect(function(input, gameProcessed)
        if gameProcessed then return end
        if input.KeyCode == Enum.KeyCode.G then
            toggleGUI()
        end
    end)
end

local function setupCharacterHandling()
    local player = game.Players.LocalPlayer
    
    local function onCharacterAdded(character)
        createFullGUI()
    end
    
    player.CharacterAdded:Connect(onCharacterAdded)
    
    if player.Character then
        createFullGUI()
    end
end

setupCharacterHandling()
